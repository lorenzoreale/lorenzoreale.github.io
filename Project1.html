<!DOCTYPE html>
<html>
<head>
  <title>Lorenzo Reale</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Lorenzo Reale</h1>
    <p>Data Analysis Portfolio</p>
  </header>

  <div class="container">
    <pre>
    <code class="language-sql">
      -- SQL query 
      -- SELECT statement with aliases and DISTINCT
SELECT DISTINCT c.customer_id, c.first_name, c.last_name, o.order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE o.total_amount > 1000
ORDER BY o.order_date DESC
LIMIT 10;

-- Aggregate functions and GROUP BY
SELECT p.product_category, COUNT(*) AS total_products, AVG(p.price) AS avg_price, MAX(p.price) AS max_price
FROM products p
GROUP BY p.product_category
HAVING COUNT(*) > 10
ORDER BY avg_price DESC;

-- Subquery and EXISTS
SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE EXISTS (
    SELECT *
    FROM orders o
    WHERE o.customer_id = c.customer_id
    AND o.order_date >= '2022-01-01'
);

-- JOIN with multiple tables and table aliases
SELECT c.first_name, c.last_name, o.order_date, p.product_name
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE c.city = 'New York'
AND o.order_date BETWEEN '2022-01-01' AND '2022-12-31';

-- CASE statement for conditional logic
SELECT order_id, order_date,
    CASE
        WHEN total_amount > 1000 THEN 'High'
        WHEN total_amount > 500 THEN 'Medium'
        ELSE 'Low'
    END AS order_priority
FROM orders;

-- Subquery with IN operator
SELECT product_name, price
FROM products
WHERE product_id IN (
    SELECT product_id
    FROM order_items
    WHERE order_id IN (
        SELECT order_id
        FROM orders
        WHERE order_date >= '2023-01-01'
    )
);

-- Self JOIN and recursive queries
WITH RECURSIVE employee_hierarchy AS (
    SELECT employee_id, first_name, last_name, manager_id, 0 AS level
    FROM employees
    WHERE manager_id IS NULL
    UNION ALL
    SELECT e.employee_id, e.first_name, e.last_name, e.manager_id, eh.level + 1
    FROM employees e
    JOIN employee_hierarchy eh ON e.manager_id = eh.employee_id
)
SELECT *
FROM employee_hierarchy
ORDER BY level, employee_id;

-- Window functions and analytical queries
SELECT product_id, product_name, price,
    ROW_NUMBER() OVER (PARTITION BY product_category ORDER BY price) AS row_num,
    RANK() OVER (PARTITION BY product_category ORDER BY price) AS rank_num,
    DENSE_RANK() OVER (PARTITION BY product_category ORDER BY price) AS dense_rank_num,
    MAX(price) OVER (PARTITION BY product_category) AS max_price
FROM products;

-- Common table expression (CTE)
WITH customer_orders AS (
    SELECT c.customer_id, c.first_name, c.last_name, COUNT(o.order_id) AS total_orders
    FROM customers c
    JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
    HAVING COUNT(o.order_id) > 5
)
SELECT customer_id, first_name, last_name, total_orders
FROM customer_orders
ORDER BY total_orders DESC;

    </code>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-sql.min.js"></script>
  <script>
    // Initialize Prism.js
    Prism.highlightAll();
  </script>
  </pre>
  </div>
</body>
</html>
